name: Deploy to Azure via FTP

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4


      - name: Install lftp
        run: sudo apt-get install -y lftp

      - name: Debug FTPS Connection
        run: |
          echo "Testing FTPS connection..."
          lftp -u "${{ secrets.AZURE_FTP_USERNAME }},${{ secrets.AZURE_FTP_PASSWORD }}" -e "open ftp://waws-prod-cq1-021.ftp.azurewebsites.windows.net; ls; bye"

      - name: Deploy to Azure Web App via FTPS
        run: |
          lftp -u "${{ secrets.AZURE_FTP_USERNAME }},${{ secrets.AZURE_FTP_PASSWORD }}" -e "mirror --reverse --delete --verbose ./ ftp://waws-prod-cq1-021.ftp.azurewebsites.windows.net/site/wwwroot; bye"